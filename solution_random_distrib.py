from src.classes.chip import Chip
from src.algorithms.utils import COLLISION_COST
from src.algorithms import random_algo as ra
import os
from sys import argv
import matplotlib.pyplot as plt
from brokenaxes import brokenaxes
import numpy as np

# BASE_DIR = os.path.dirname(__file__)
# os.chdir(BASE_DIR)

OUTPUT_FOLDER = "output"

base_data_path = r"data/"
chip_id = 0
net_id = 1

if len(argv) >= 2:
    chip_id = argv[1]

if len(argv) == 3:
    net_id = argv[2]


iterations = 1000
total_costs = []

for i in range(iterations):
    print(i)
    chip = Chip(base_data_path, chip_id=chip_id, net_id=net_id, output_folder=OUTPUT_FOLDER)
    algorithm = ra.Pseudo_random(chip, max_offset=5, allow_short_circuit=True, sort_wires=True, random_seed=i)
    algorithm.run()
    cost = chip.calc_total_grid_cost()
    if chip.is_fully_connected():
        total_costs.append(cost)

print(total_costs)
total_costs = [1000630, 1000632, 1001226, 28, 1000926, 1000930, 1001230, 1000624, 28, 1001234, 1000928, 1000332, 1000632, 1000628, 1000934, 1000930, 1000626, 1001234, 1000930, 1001230, 26, 328, 630, 1000928, 30, 330, 1001232, 28, 1000934, 1001836, 1000928, 30, 1001228, 1001840, 1000926, 1001228, 328, 1001836, 1000630, 1001230, 334, 330, 330, 632, 1000936, 1001836, 1001538, 1001230, 326, 1001828, 1000630, 1001832, 1001536, 1000930, 1000636, 1001834, 1000922, 330, 1001534, 1001228, 1000634, 1001836, 1000932, 1000632, 1001230, 1001534, 326, 1000622, 1001832, 1000930, 928, 1001536, 1000634, 1001532, 1000926, 1001828, 1001532, 330, 1001830, 1002130, 930, 1000326, 1001230, 1002734, 1001538, 1001534, 1001832, 1000930, 1000630, 1002136, 1000934, 1001228, 326, 1002128, 1000632, 330, 1000932, 1000624, 1001236, 628, 328, 1002430, 1002128, 1000638, 1000628, 1001526, 928, 1001538, 1001538, 330, 1001528, 634, 34, 1000926, 632, 28, 332, 1001532, 1000934, 1001536, 1001232, 1001534, 1001834, 1000628, 1000628, 1000930, 1000928, 1001832, 1000934, 1001834, 1001538, 624, 1001832, 1000628, 1001534, 1001228, 1000934, 1000926, 330, 1000630, 630, 332, 1000328, 1000928, 1001530, 324, 1002436, 1001836, 1001234, 1001232, 1002438, 1001528, 1001232, 1000634, 1001230, 1000924, 1000928, 1000932, 1000926, 634, 1000926, 1000632, 1001234, 330, 322, 326, 1001530, 32, 1001230, 1001230, 928, 326, 326, 1000924, 1001532, 20, 1000332, 1000932, 1000634, 630, 1000930, 1000934, 1001532, 1001532, 1000632, 28, 26, 1001232, 1003640, 1000926, 1002730, 1002428, 1002138, 324, 1001532, 926, 1001230, 1001532, 1000928, 1000932, 1003636, 1000330, 1001536, 330, 1000930, 1001832, 1001834, 330, 1001830, 1000926, 1000928, 1000928, 630, 28, 1001532, 1001536, 630, 630, 1000932, 1001230, 328, 1001236, 334, 1001528, 1001528, 1001536, 334, 330, 332, 626, 332, 326, 324, 32, 30, 1001532, 1001834, 1002734, 324, 332, 1001536, 336, 1002130, 32, 1000334, 1002126, 1001234, 1000928, 1000928, 930, 1000624, 628, 1000628, 1000628, 36, 1002430, 1001826, 32, 1001226, 1001534, 938, 1000638, 1000930, 1000632, 1002132, 326, 1000628, 1000932, 30, 1000626, 630, 632, 1000932, 1000932, 26, 1001532, 1001828, 1000632, 330, 1001226, 1001536, 332, 1000926, 632, 1001232, 1001534, 1001834, 328, 1000930, 1001830, 1000628, 1000932, 1001236, 1000630, 1001226, 1000932, 1000622, 1001230, 1000630, 1001532, 26, 1001232, 1001532, 1001824, 1001230, 1002138, 1000630, 1000926, 1000628, 30, 28, 1001236, 1000628, 1000628, 1001530, 1000930, 1001538, 1000930, 1002430, 330, 1002132, 1001228, 1001232, 632, 334, 330, 328, 32, 30, 1001530, 40, 28, 1001230, 326, 30, 330, 1000928, 26, 1001228, 34, 32, 1000632, 1000628, 1000934, 334, 28, 328, 630, 1000328, 1000630, 1001832, 1002128, 1001224, 1000332, 30, 1001230, 1000928, 1000938, 326, 1001534, 636, 1001536, 1000328, 1000626, 1002730, 1000622, 1000930, 328, 1001538, 28, 1000928, 636, 1001530, 1001530, 1000928, 1001232, 1000626, 1534, 26, 1001234, 1000926, 1001232, 330, 1000628, 330, 1000930, 1001226, 628, 1000626, 22, 1000324, 1000930, 1001228, 1001832, 334, 1001832, 1001232, 630, 334, 1000632, 626, 1001236, 332, 626, 626, 30, 1000628, 26, 1000928, 634, 632, 1000634, 1001532, 1001830, 1001832, 334, 1001830, 30, 1001226, 20, 322, 332, 1000932, 1001526, 1002134, 28, 1000924, 30, 1000928, 1001234, 1000932, 1000928, 28, 1000630, 1000628, 1002130, 1001228, 1001234, 1002134, 1000624, 328, 1000626, 32, 1000932, 1000926, 328, 1000928, 1000926, 1000932, 1001230, 1000926, 1002134, 1000634, 1001234, 1002430, 632, 1001828, 1000924, 928, 1001830, 1000934, 330, 1001830, 1228, 1000926, 1001234, 1001834, 1001222, 336, 1001530, 1001828, 1000932, 626, 1001832, 1000932, 1000934, 1002730, 1001238, 1000932, 1001832, 1000630, 1002128, 1000628, 1000924, 1001530, 1001532, 936, 1000928, 1000930, 1000626, 1000632, 1000634, 630, 1000930, 1000932, 328, 1000624, 26, 1000326, 1001532, 928, 1001224, 1001830, 1000630, 1000628, 1000932, 1002132, 1000636, 1000330, 634, 1000630, 1001832, 1002430, 1000932, 630, 1001530, 1000928, 1000326, 1000932, 636, 1001832, 1001226, 1000930, 1001236, 626, 1000628, 32, 326, 34, 1001830, 630, 1000930, 22, 1000632, 1001228, 932, 1001228, 1000630, 32, 1001236, 1001228, 1001530, 1001528, 1001232, 1000628, 930, 1000934, 1001228, 328, 28, 928, 1001226, 1001530, 1000926, 1000634, 1000930, 1001532, 328, 1000930, 1002734, 1000932, 1001830, 1001832, 26, 1000932, 1001232, 1003030, 1001236, 32, 1001532, 1000632, 1000922, 328, 330, 1000930, 1000632, 1000934, 1002436, 328, 328, 1001236, 1001528, 328, 1000632, 326, 1000632, 332, 1001832, 1001534, 1000930, 1001530, 24, 1001834, 1000930, 630, 32, 1000932, 630, 1002434, 632, 1000626, 1000930, 1001230, 24, 628, 1000326, 332, 630, 326, 326, 1001238, 1228, 1000934, 1000628, 24, 1000930, 1000328, 1000332, 1000926, 1001234, 1001232, 1002128, 30, 1000932, 1001522, 1001536, 1000630, 1001228, 1000926, 1230, 1002132, 338, 1001830, 1000332, 330, 1001238, 1000630, 1000632, 1000626, 1002130, 1000924, 1001232, 1001834, 336, 26, 1001532, 632, 1000924, 1002134, 332, 1000922, 1000932, 1000930, 1000626, 930, 1000934, 32, 1000628, 1001236, 1001830, 1002738, 1000928, 1000928, 1000632, 1001532, 1000932, 1001536, 1001530, 1000936, 34, 1000922, 1000628, 1001232, 1001224, 1000930, 1000626, 1000334, 1001828, 628, 1002436, 1001534, 32, 1001828, 32, 1001228, 1000924, 1000928, 30, 1001230, 1001834, 622, 340, 1001532, 1000930, 1000928, 1001224, 1000926, 1001838, 1000936, 1001534, 22, 1001532, 1002132, 1000626, 1001232, 324, 1000934, 1001236, 1000626, 330, 638, 1002738, 328, 1000924, 630, 1001230, 1001526, 22, 1000328, 1001524, 330, 1000924, 1001534, 30, 1001532, 1000922, 1002730, 1001222, 1001830, 1001526, 1000926, 332, 336, 1001230, 1001524, 328, 1001532, 1000926, 1001538, 1000630, 1001834, 1001532, 1000632, 1000628, 1001234, 1000922, 1001234, 1000628, 332, 1000934, 1001832, 326, 1001534, 1000926, 1000632, 1001232, 1001234, 328, 1001534, 1232, 34, 1001534, 1000628, 1001528, 330, 1001228, 1000626, 1000636, 1000928, 1001530, 1000932, 1000926, 1001534, 1001224, 1002728, 1000926, 1001236, 1000334, 1002130, 1001528, 1000930, 1000936, 324, 1001532, 626, 1000328, 1001834, 932, 1001230, 1001832, 1000930, 1000932, 324, 32, 1001532, 632, 1001830, 1002128, 1001230, 1001834, 1003032, 1001828, 326, 28, 1000930, 1000632, 322, 1001236, 1000932, 630, 1000632, 328, 1001528, 1001230, 1000626, 638, 1000328, 1002426, 328, 1001532, 1000930, 1000934, 1000928, 628, 324, 1002432, 28, 1000930, 326, 1001234, 1000930, 1001228, 1001526, 1001232, 1000936, 628, 1001232, 326, 1001530, 1001230, 1000928, 1000620, 1002130, 1000932, 1001230, 1001530, 1001226, 1001530, 1001830, 626, 1000626, 1000634, 1001232, 1001830, 1002130, 1000932, 1000630, 332, 1001528, 32, 328, 1000622, 1000628, 1000932, 1001238, 332, 1230, 1001536, 1000328, 1002130, 1003034, 632, 1000928, 1001230, 1000926, 1000622, 1001228, 324, 1001228, 1001234, 1001534, 1002130, 1001830, 1000628, 1001536, 32, 1001232, 1001532, 1001230, 26, 1001532, 1001228, 1000932, 1001526, 1001226, 1001234, 1000932, 1000936, 1001232, 1001832, 1000926, 1000334, 1001234, 1000932, 1001534, 1001538, 1001232, 1001526, 1000926, 1000932, 1000632, 1001232, 1000638, 32, 332, 1000634, 330, 930, 1001828, 1003038, 1000928, 930, 1001826, 1001536, 1000934, 1002130, 1001238, 1001532, 1001532, 1000926, 1000926, 32, 1001230, 1000326, 1001828, 1001226, 1000634, 1000930, 1002432, 1000928, 322, 1000934, 1001228, 1001226, 1000936, 1002736, 1000932, 1001228, 1001234, 326, 1001224, 334, 326, 930, 1000934, 1002128, 1001534, 1000628, 332, 324, 632, 1001530, 1000932, 1001832, 1000938, 320, 1000930, 1001524, 1001232, 334, 1001530, 326, 1000928, 32, 932, 326, 1001232, 1002130, 634, 1001528, 1001534, 626, 330, 1000930, 634, 1000328, 1000932, 28, 1000628, 328, 1001532, 1000634, 1000928, 1000322, 1000926, 1000934, 1001230, 1000930, 1000930, 1001226]

total_costs = np.array(total_costs)

segment1 = total_costs[(total_costs >= 0) & (total_costs <= 1000)]
segment2 = total_costs[(total_costs >= 999000) & (total_costs <= 1001000)]

bax = brokenaxes(xlims=((10, 50), (1000310, 1000350)), hspace=0.5)

bax.set_title(f"Cost Histogram True Random Algorithm (Chip {chip_id}, Net {net_id})")
bax.hist(segment1, bins=500, color='blue', alpha=0.7, label='0-10,000')
bax.hist(segment2, bins=176, color='green', alpha=0.7, label='990,000-1,010,000')
bax.set_xlabel("Cost")
bax.set_ylabel("Frequency")

distrib_path = os.path.join(OUTPUT_FOLDER, "distributions")
save_name = f"cost_distrib_random_chip_{chip_id}_net{net_id}"
save_path = os.path.join(distrib_path, save_name)
plt.savefig(save_path)

